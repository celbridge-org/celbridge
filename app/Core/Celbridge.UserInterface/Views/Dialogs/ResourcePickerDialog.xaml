<ContentDialog
  x:Class="Celbridge.UserInterface.Views.ResourcePickerDialog"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="using:Celbridge.UserInterface.Views"
  xmlns:vm="using:Celbridge.UserInterface.ViewModels"
  xmlns:controls="using:Celbridge.UserInterface.Views.Controls"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  Title="{x:Bind TitleString}"
  PrimaryButtonText="{x:Bind OkString}"
  SecondaryButtonText="{x:Bind CancelString}"
  IsPrimaryButtonEnabled="{x:Bind ViewModel.IsSubmitEnabled, Mode=OneWay}"
  Opened="Dialog_Opened">

  <Grid Width="480">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="400"/>
    </Grid.RowDefinitions>

    <!-- Preview thumbnail positioned at top-right, overlapping title area -->
    <Border Grid.Row="0"
            Grid.RowSpan="2"
            Width="100"
            Height="100"
            Margin="0,-40,0,0"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Background="{ThemeResource LayerFillColorDefaultBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Visibility="{x:Bind ViewModel.PreviewPanelVisibility, Mode=OneWay}">
      <Image Source="{x:Bind ViewModel.PreviewImage, Mode=OneWay}"
             Stretch="Uniform"
             Visibility="{x:Bind ViewModel.PreviewImageVisibility, Mode=OneWay}"/>
    </Border>

    <!-- Search box -->
    <TextBox x:Name="SearchTextBox"
             Grid.Row="0"
             PlaceholderText="{x:Bind SearchPlaceholderString}"
             Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
             IsSpellCheckEnabled="False"
             AcceptsReturn="False"
             Margin="0,0,112,0"
             KeyDown="SearchTextBox_KeyDown"/>

    <!-- Resource list -->
    <ListView x:Name="ResourceListView"
              Grid.Row="1"
              ItemsSource="{x:Bind ViewModel.FilteredItems, Mode=OneWay}"
              SelectedItem="{x:Bind ViewModel.SelectedItem, Mode=TwoWay}"
              SelectionMode="Single"
              Margin="0,4,0,0"
              IsDoubleTapEnabled="True"
              DoubleTapped="ResourceListView_DoubleTapped"
              KeyDown="ResourceListView_KeyDown">
      <ListView.ItemContainerStyle>
        <Style TargetType="ListViewItem">
          <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
          <Setter Property="Padding" Value="0"/>
          <Setter Property="Margin" Value="0"/>
          <Setter Property="MinHeight" Value="32"/>
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="ListViewItem">
                <Grid x:Name="ContentGrid"
                      Padding="{TemplateBinding Padding}"
                      Background="Transparent">
                  <ContentPresenter/>

                  <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup x:Name="CommonStates">
                      <VisualState x:Name="Normal"/>

                      <VisualState x:Name="PointerOver">
                        <VisualState.Setters>
                          <Setter Target="ContentGrid.Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}"/>
                        </VisualState.Setters>
                      </VisualState>

                      <VisualState x:Name="Pressed">
                        <VisualState.Setters>
                          <Setter Target="ContentGrid.Background" Value="{ThemeResource SubtleFillColorTertiaryBrush}"/>
                        </VisualState.Setters>
                      </VisualState>

                      <VisualState x:Name="Selected">
                        <VisualState.Setters>
                          <Setter Target="ContentGrid.Background" Value="{ThemeResource ListItemSelectedBackgroundBrush}"/>
                        </VisualState.Setters>
                      </VisualState>

                      <VisualState x:Name="SelectedPointerOver">
                        <VisualState.Setters>
                          <Setter Target="ContentGrid.Background" Value="{ThemeResource ListItemSelectedBackgroundBrush}"/>
                        </VisualState.Setters>
                      </VisualState>

                      <VisualState x:Name="SelectedPressed">
                        <VisualState.Setters>
                          <Setter Target="ContentGrid.Background" Value="{ThemeResource ListItemSelectedBackgroundBrush}"/>
                        </VisualState.Setters>
                      </VisualState>
                    </VisualStateGroup>
                  </VisualStateManager.VisualStateGroups>
                </Grid>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </ListView.ItemContainerStyle>
      <ListView.ItemTemplate>
        <DataTemplate x:DataType="vm:ResourcePickerItem">
          <Grid MinHeight="32">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="24"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <controls:FileIcon Grid.Column="0"
                               Size="16"
                               IconDefinition="{x:Bind IconDefinition}"
                               VerticalAlignment="Center"/>

            <TextBlock Grid.Column="1"
                       Text="{x:Bind DisplayText}"
                       VerticalAlignment="Center"
                       Margin="8,0,0,0"
                       TextTrimming="CharacterEllipsis"/>
          </Grid>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>
  </Grid>

</ContentDialog>
