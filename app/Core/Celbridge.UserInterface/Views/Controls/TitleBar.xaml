<UserControl
    x:Class="Celbridge.UserInterface.Views.TitleBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Celbridge.UserInterface.Views"
    xmlns:services="using:Celbridge.UserInterface.Services">

    <UserControl.Resources>
        <services:BoolToOpacityConverter x:Key="BoolToOpacityConverter"/>
        <services:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid x:Name="MainGrid"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Top"
          Background="{ThemeResource TitleBarActiveColor}"
          BorderBrush="{ThemeResource SplitterBrush}"
          BorderThickness="0 0 0 1">

        <!-- TitleBar changes to a lighter color when the application loses focus (Windows only) -->
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="BackgroundStates">
                <VisualState x:Name="Active">
                </VisualState>
                <VisualState x:Name="Inactive">
                    <VisualState.Setters>
                        <Setter Target="MainGrid.Background" Value="{ThemeResource TitleBarInactiveColor}"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="48"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="144"/><!-- Space for window caption buttons -->
        </Grid.ColumnDefinitions>

        <Image Source="ms-appx:///Assets/Images/title_icon.png"
               Width="28" Height="28"
               Margin="0"
               HorizontalAlignment="Center"
               VerticalAlignment="Center" />

        <!-- Page Navigation Toolbar -->
        <controls:PageNavigationToolbar x:Name="PageNavigationToolbar"
                                        Grid.Column="1"/>

        <!-- Save Icon - positioned to the left of layout toolbar -->
        <FontIcon x:Name="SaveIcon"
                  Grid.Column="3"
                  Visibility="{x:Bind ViewModel.IsWorkspaceActive, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Center"
                  Margin="0,0,16,0"
                  Opacity="{x:Bind ViewModel.IsSaving, Mode=OneWay, Converter={StaticResource BoolToOpacityConverter}}"
                  FontFamily="{ThemeResource SymbolThemeFontFamily}"
                  FontSize="18"
                  Glyph="&#xE74E;"/>

        <!-- Layout Toolbar - positioned on the right side of the title bar -->
        <controls:LayoutToolbar x:Name="LayoutToolbar"
                                Grid.Column="4"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Margin="0,0,8,0"/>

        <!-- Settings Button - positioned between layout toolbar and window controls -->
        <Button x:Name="SettingsButton"
                Grid.Column="5"
                Click="SettingsButton_Click"
                Background="Transparent"
                BorderThickness="0"
                Padding="12,8"
                VerticalAlignment="Center">
            <SymbolIcon Symbol="Setting"/>
        </Button>
  </Grid>
</UserControl>

