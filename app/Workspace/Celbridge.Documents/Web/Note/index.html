<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Editor</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="https://shared.celbridge/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="note.css">
    <link rel="stylesheet" href="note-image-popover.css">
    <link rel="stylesheet" href="note-link-popover.css">
    <link rel="stylesheet" href="note-table-popover.css">
</head>
<body>
    <div id="toolbar">
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="bold" data-loc-key="NoteEditor_Toolbar_Bold" data-loc-attr="title" title="Bold (Ctrl+B)"><i class="bi bi-type-bold"></i></button>
            <button class="toolbar-btn" data-action="italic" data-loc-key="NoteEditor_Toolbar_Italic" data-loc-attr="title" title="Italic (Ctrl+I)"><i class="bi bi-type-italic"></i></button>
            <button class="toolbar-btn" data-action="underline" data-loc-key="NoteEditor_Toolbar_Underline" data-loc-attr="title" title="Underline (Ctrl+U)"><i class="bi bi-type-underline"></i></button>
            <button class="toolbar-btn" data-action="strike" data-loc-key="NoteEditor_Toolbar_Strikethrough" data-loc-attr="title" title="Strikethrough"><i class="bi bi-type-strikethrough"></i></button>
            <button class="toolbar-btn" data-action="code" data-loc-key="NoteEditor_Toolbar_InlineCode" data-loc-attr="title" title="Inline Code"><i class="bi bi-code-slash"></i></button>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="heading1" data-loc-key="NoteEditor_Toolbar_Heading1" data-loc-attr="title" title="Heading 1"><i class="bi bi-type-h1"></i></button>
            <button class="toolbar-btn" data-action="heading2" data-loc-key="NoteEditor_Toolbar_Heading2" data-loc-attr="title" title="Heading 2"><i class="bi bi-type-h2"></i></button>
            <button class="toolbar-btn" data-action="heading3" data-loc-key="NoteEditor_Toolbar_Heading3" data-loc-attr="title" title="Heading 3"><i class="bi bi-type-h3"></i></button>
            <button class="toolbar-btn" data-action="paragraph" data-loc-key="NoteEditor_Toolbar_Paragraph" data-loc-attr="title" title="Paragraph"><i class="bi bi-text-paragraph"></i></button>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="bulletList" data-loc-key="NoteEditor_Toolbar_BulletList" data-loc-attr="title" title="Bullet List"><i class="bi bi-list-ul"></i></button>
            <button class="toolbar-btn" data-action="orderedList" data-loc-key="NoteEditor_Toolbar_OrderedList" data-loc-attr="title" title="Ordered List"><i class="bi bi-list-ol"></i></button>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="blockquote" data-loc-key="NoteEditor_Toolbar_Blockquote" data-loc-attr="title" title="Blockquote"><i class="bi bi-blockquote-left"></i></button>
            <button class="toolbar-btn" data-action="codeBlock" data-loc-key="NoteEditor_Toolbar_CodeBlock" data-loc-attr="title" title="Code Block"><i class="bi bi-braces"></i></button>
            <button class="toolbar-btn" data-action="horizontalRule" data-loc-key="NoteEditor_Toolbar_HorizontalRule" data-loc-attr="title" title="Horizontal Rule"><i class="bi bi-dash-lg"></i></button>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="link" data-loc-key="NoteEditor_Toolbar_InsertLink" data-loc-attr="title" title="Insert/Edit Link"><i class="bi bi-link-45deg"></i></button>
            <button class="toolbar-btn" data-action="image" data-loc-key="NoteEditor_Toolbar_InsertImage" data-loc-attr="title" title="Insert Image"><i class="bi bi-image"></i></button>
            <button class="toolbar-btn" data-action="table" data-loc-key="NoteEditor_Toolbar_InsertTable" data-loc-attr="title" title="Insert/Edit Table"><i class="bi bi-table"></i></button>
        </div>
        <div class="toolbar-separator"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" data-action="undo" data-loc-key="NoteEditor_Toolbar_Undo" data-loc-attr="title" title="Undo (Ctrl+Z)"><i class="bi bi-arrow-counterclockwise"></i></button>
            <button class="toolbar-btn" data-action="redo" data-loc-key="NoteEditor_Toolbar_Redo" data-loc-attr="title" title="Redo (Ctrl+Shift+Z)"><i class="bi bi-arrow-clockwise"></i></button>
        </div>
    </div>

    <div id="editor-wrapper">
        <div id="image-popover" class="popover">
            <div class="popover-header">
                <i class="bi bi-image popover-icon"></i>
                <span data-loc-key="NoteEditor_Image_Header">Image</span>
            </div>
            <!-- View mode: layout controls, then src link, action buttons -->
            <div id="image-popover-view-mode" class="popover-mode">
                <!-- Size and align buttons on the same row with separator -->
                <div class="img-popover-layout-row">
                    <button class="img-popover-size-btn" data-img-action="size-25" data-loc-key="NoteEditor_Image_Size25" data-loc-attr="title" title="25% width">25%</button>
                    <button class="img-popover-size-btn" data-img-action="size-75" data-loc-key="NoteEditor_Image_Size75" data-loc-attr="title" title="75% width">75%</button>
                    <button class="img-popover-size-btn" data-img-action="size-50" data-loc-key="NoteEditor_Image_Size50" data-loc-attr="title" title="50% width">50%</button>
                    <button class="img-popover-size-btn" data-img-action="size-100" data-loc-key="NoteEditor_Image_SizeFull" data-loc-attr="title" title="Full width">100%</button>
                    <div class="img-popover-custom-size-wrapper">
                        <input type="text" id="image-popover-custom-size-input" data-loc-key="NoteEditor_Image_CustomSizeTooltip" data-loc-attr="title" title="Enter image width as a percentage (1–100)" placeholder="%" />
                        <span class="img-popover-custom-size-label">%</span>
                    </div>
                    <div class="img-popover-separator"></div>
                    <button class="img-popover-align-btn" data-img-action="align-left" data-loc-key="NoteEditor_Image_AlignLeft" data-loc-attr="title" title="Align left"><i class="bi bi-text-left"></i></button>
                    <button class="img-popover-align-btn" data-img-action="align-center" data-loc-key="NoteEditor_Image_AlignCenter" data-loc-attr="title" title="Align center"><i class="bi bi-text-center"></i></button>
                    <button class="img-popover-align-btn" data-img-action="align-right" data-loc-key="NoteEditor_Image_AlignRight" data-loc-attr="title" title="Align right"><i class="bi bi-text-right"></i></button>
                </div>
                <!-- Image source as clickable link -->
                <div class="popover-field">
                    <span class="popover-field-label" data-loc-key="NoteEditor_Image_SourceLabel">Source</span>
                    <span id="image-popover-src-display"></span>
                </div>
                <div class="popover-buttons">
                    <button id="image-popover-edit-btn" class="popover-btn" data-loc-key="NoteEditor_Image_EditTooltip" data-loc-attr="title" title="Edit source and caption"><i class="bi bi-pencil"></i></button>
                    <button id="image-popover-delete" class="popover-btn popover-btn-danger" data-loc-key="NoteEditor_Image_DeleteTooltip" data-loc-attr="title" title="Delete image"><i class="bi bi-trash3"></i></button>
                </div>
            </div>
            <!-- Edit mode: live source + caption inputs with labels, cancel reverts -->
            <div id="image-popover-edit-mode" class="popover-mode">
                <div class="popover-field">
                    <label class="popover-field-label" for="image-popover-src-input" data-loc-key="NoteEditor_Image_SourceLabel">Source</label>
                    <input type="text" id="image-popover-src-input" data-loc-key="NoteEditor_Image_SrcPlaceholder" data-loc-attr="placeholder" placeholder="URL or resource key..." />
                </div>
                <div class="popover-field">
                    <label class="popover-field-label" for="image-popover-caption-input" data-loc-key="NoteEditor_Image_CaptionLabel">Caption</label>
                    <input type="text" id="image-popover-caption-input" data-loc-key="NoteEditor_Image_CaptionPlaceholder" data-loc-attr="placeholder" placeholder="Optional caption text..." />
                </div>
                <div class="popover-buttons">
                    <button id="image-popover-confirm" class="popover-btn popover-btn-primary" data-loc-key="NoteEditor_Image_ConfirmTooltip" data-loc-attr="title" title="Accept changes"><i class="bi bi-check-lg"></i></button>
                    <button id="image-popover-cancel" class="popover-btn" data-loc-key="NoteEditor_Image_CancelTooltip" data-loc-attr="title" title="Cancel — revert to previous values"><i class="bi bi-x-lg"></i></button>
                </div>
            </div>
        </div>
        <div id="link-popover" class="popover">
            <div class="popover-header">
                <i class="bi bi-link-45deg popover-icon"></i>
                <span data-loc-key="NoteEditor_Link_Header">Link</span>
            </div>
            <!-- View mode: read-only URL with Open/Edit/Delete -->
            <div id="link-popover-view-mode" class="popover-mode">
                <div id="link-popover-url-display"></div>
                <div class="popover-buttons">
                    <button id="link-popover-open" class="popover-btn" data-loc-key="NoteEditor_Link_OpenTooltip" data-loc-attr="title" title="Open link"><i class="bi bi-box-arrow-up-right"></i></button>
                    <button id="link-popover-edit-btn" class="popover-btn" data-loc-key="NoteEditor_Link_EditTooltip" data-loc-attr="title" title="Edit link"><i class="bi bi-pencil"></i></button>
                    <button id="link-popover-delete" class="popover-btn popover-btn-danger" data-loc-key="NoteEditor_Link_DeleteTooltip" data-loc-attr="title" title="Remove link"><i class="bi bi-trash3"></i></button>
                </div>
            </div>
            <!-- Edit mode: editable input with Confirm/Cancel -->
            <div id="link-popover-edit-mode" class="popover-mode">
                <input type="text" id="link-popover-input" data-loc-key="NoteEditor_Link_Placeholder" data-loc-attr="placeholder" placeholder="Enter URL or resource key..." />
                <div class="popover-buttons">
                    <button id="link-popover-confirm" class="popover-btn popover-btn-primary" data-loc-key="NoteEditor_Link_ConfirmTooltip" data-loc-attr="title" title="Confirm"><i class="bi bi-check-lg"></i></button>
                    <button id="link-popover-cancel" class="popover-btn" data-loc-key="NoteEditor_Link_CancelTooltip" data-loc-attr="title" title="Cancel"><i class="bi bi-x-lg"></i></button>
                </div>
            </div>
        </div>
        <div id="table-popover" class="popover">
            <div class="popover-header">
                <i class="bi bi-table popover-icon"></i>
                <span data-loc-key="NoteEditor_Table_Header">Table</span>
            </div>
            <!-- Create mode: configure rows, columns, header before inserting -->
            <div id="table-popover-create-mode" class="popover-mode">
                <div class="table-popover-control-row">
                    <div class="table-popover-control-group">
                        <label for="table-create-rows" data-loc-key="NoteEditor_Table_RowsLabel">Rows</label>
                        <input type="number" id="table-create-rows" min="1" max="20" value="3" />
                    </div>
                    <div class="table-popover-control-group">
                        <label for="table-create-cols" data-loc-key="NoteEditor_Table_ColumnsLabel">Columns</label>
                        <input type="number" id="table-create-cols" min="1" max="20" value="3" />
                    </div>
                </div>
                <label class="table-popover-checkbox">
                    <input type="checkbox" id="table-create-header" checked />
                    <span data-loc-key="NoteEditor_Table_HeaderRowLabel">Header row</span>
                </label>
                <div class="popover-buttons">
                    <button id="table-popover-create-confirm" class="popover-btn popover-btn-primary" data-loc-key="NoteEditor_Table_InsertTooltip" data-loc-attr="title" title="Insert table"><i class="bi bi-check-lg"></i></button>
                    <button id="table-popover-create-cancel" class="popover-btn" data-loc-key="NoteEditor_Table_CancelTooltip" data-loc-attr="title" title="Cancel"><i class="bi bi-x-lg"></i></button>
                </div>
            </div>
            <!-- View mode: table info, row/column actions, toggle header, delete -->
            <div id="table-popover-view-mode" class="popover-mode">
                <div class="popover-field">
                    <span class="popover-field-label" data-loc-key="NoteEditor_Table_SizeLabel">Size</span>
                    <span id="table-view-info"></span>
                </div>
                <div class="table-popover-grid">
                    <span class="table-popover-grid-label" data-loc-key="NoteEditor_Table_RowLabel">Row</span>
                    <button id="table-add-row" class="table-popover-action-btn" data-loc-key="NoteEditor_Table_AddRowTooltip" data-loc-attr="title" title="Add row below"><i class="bi bi-plus table-popover-action-icon"></i> <span data-loc-key="NoteEditor_Table_Add">Add</span></button>
                    <button id="table-delete-row" class="table-popover-action-btn table-popover-action-btn-danger" data-loc-key="NoteEditor_Table_DeleteRowTooltip" data-loc-attr="title" title="Delete current row"><i class="bi bi-dash table-popover-action-icon"></i> <span data-loc-key="NoteEditor_Table_Remove">Remove</span></button>
                    <span class="table-popover-grid-label" data-loc-key="NoteEditor_Table_ColumnLabel">Column</span>
                    <button id="table-add-col" class="table-popover-action-btn" data-loc-key="NoteEditor_Table_AddColumnTooltip" data-loc-attr="title" title="Add column to the right"><i class="bi bi-plus table-popover-action-icon"></i> <span data-loc-key="NoteEditor_Table_Add">Add</span></button>
                    <button id="table-delete-col" class="table-popover-action-btn table-popover-action-btn-danger" data-loc-key="NoteEditor_Table_DeleteColumnTooltip" data-loc-attr="title" title="Delete current column"><i class="bi bi-dash table-popover-action-icon"></i> <span data-loc-key="NoteEditor_Table_Remove">Remove</span></button>
                </div>
                <div class="table-popover-footer-row">
                    <label class="table-popover-checkbox">
                        <input type="checkbox" id="table-toggle-header" />
                        <span data-loc-key="NoteEditor_Table_HeaderRowLabel">Header row</span>
                    </label>
                    <div style="flex:1"></div>
                    <button id="table-delete" class="popover-btn popover-btn-danger" data-loc-key="NoteEditor_Table_DeleteTooltip" data-loc-attr="title" title="Delete table"><i class="bi bi-trash3"></i></button>
                </div>
            </div>
        </div>
        <div id="editor"></div>
    </div>

    <script type="module" src="note.js"></script>
</body>
</html>
