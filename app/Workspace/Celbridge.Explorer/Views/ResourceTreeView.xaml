<UserControl
    x:Class="Celbridge.Explorer.Views.ResourceTreeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Celbridge.Explorer.Views"
    xmlns:explorer="using:Celbridge.Explorer"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:models="using:Celbridge.Explorer.Models"
    xmlns:controls="using:Celbridge.UserInterface.Views.Controls"
    DataContext="{x:Bind ViewModel}"
    Background="{ThemeResource ApplicationBackgroundBrush}">

  <UserControl.Resources>
    <MenuFlyout x:Name="ResourceContextMenu"
                Placement="RightEdgeAlignedTop"
                Opening="ResourceContextMenu_Opening">
      <MenuFlyoutItem Text="{x:Bind RunString}"
                      Click="ResourceContextMenu_Run"
                      IsEnabled="{x:Bind ViewModel.IsExecutableResourceSelected, Mode=OneWay}" />
      <MenuFlyoutItem Text="{x:Bind OpenString}"
                      Click="ResourceContextMenu_Open"
                      IsEnabled="{x:Bind ViewModel.IsDocumentResourceSelected, Mode=OneWay}" />

      <MenuFlyoutItem Text="{x:Bind AddFileString}"
                      Icon="Page2"
                      Click="ResourceContextMenu_AddFile">
      </MenuFlyoutItem>

      <MenuFlyoutItem Text="{x:Bind AddFolderString}"
                      Icon="Folder"
                      Click="ResourceContextMenu_AddFolder">
      </MenuFlyoutItem>
      <MenuFlyoutSeparator />
      <MenuFlyoutItem Text="{x:Bind CutString}"
                      Icon="Cut"
                      Click="ResourceContextMenu_Cut"
                      IsEnabled="{x:Bind ViewModel.IsResourceSelected, Mode=OneWay}" />
      <MenuFlyoutItem Text="{x:Bind CopyString}"
                      Icon="Copy"
                      Click="ResourceContextMenu_Copy"
                      IsEnabled="{x:Bind ViewModel.IsResourceSelected, Mode=OneWay}" />
      <MenuFlyoutItem Text="{x:Bind PasteString}"
                      Icon="Paste"
                      Click="ResourceContextMenu_Paste"
                      IsEnabled="{x:Bind ViewModel.IsResourceOnClipboard, Mode=OneWay}" />
      <MenuFlyoutItem Text="{x:Bind DeleteString}"
                      Icon="Delete"
                      Click="ResourceContextMenu_Delete"
                      IsEnabled="{x:Bind ViewModel.IsResourceSelected, Mode=OneWay}" />
      <MenuFlyoutItem Text="{x:Bind RenameString}"
                      Icon="Edit"
                      Click="ResourceContextMenu_Rename"
                      IsEnabled="{x:Bind ViewModel.IsResourceSelected, Mode=OneWay}" />
      <MenuFlyoutSeparator />
      <MenuFlyoutItem Text="{x:Bind CopyResourceKeyString}"
                      Click="ResourceContextMenu_CopyResourceKey"
                      IsEnabled="{x:Bind ViewModel.IsResourceSelected, Mode=OneWay}" />
      <MenuFlyoutItem Text="{x:Bind CopyFilePathString}"
                      Click="ResourceContextMenu_CopyFilePath"
                      IsEnabled="{x:Bind ViewModel.IsResourceSelected, Mode=OneWay}" />
      <MenuFlyoutSeparator />
      <MenuFlyoutItem Text="{x:Bind OpenFileExplorerString}"
                      Click="ResourceContextMenu_OpenFileExplorer"/>
      <MenuFlyoutItem Text="{x:Bind OpenApplicationString}"
                      Click="ResourceContextMenu_OpenApplication"
                      IsEnabled="{x:Bind ViewModel.IsFileResourceSelected, Mode=OneWay}"/>
    </MenuFlyout>

    <DataTemplate x:Key="FolderTemplate"
                  x:DataType="muxc:TreeViewNode">
      <muxc:TreeViewItem ContextFlyout="{StaticResource ResourceContextMenu}"
                         DoubleTapped="TreeViewItem_DoubleTapped">
        <StackPanel Orientation="Horizontal">
          <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}"
                    Glyph="&#xE8D5;"
                    FontSize="16"
                    Margin="0 4 6 0"
                    VerticalAlignment="Center"
                    Foreground="#FFCC40" />
          <TextBlock Margin="0"
                     VerticalAlignment="Center"
                     Text="{Binding Path=Content.Name, Mode=OneWay}" />
        </StackPanel>
      </muxc:TreeViewItem>
    </DataTemplate>

    <DataTemplate x:Key="FileTemplate"
                  x:DataType="muxc:TreeViewNode">
      <muxc:TreeViewItem ContextFlyout="{StaticResource ResourceContextMenu}"
                         DoubleTapped="TreeViewItem_DoubleTapped">
        <StackPanel Orientation="Horizontal">
          <controls:FileIcon IconDefinition="{Binding Path=Content.Icon}"
                             Size="16"
                             MinWidth="20"
                             Margin="0" />
          <TextBlock Margin="4 0 0 0"
                     Text="{Binding Path=Content.Name, Mode=OneWay}" />
        </StackPanel>
      </muxc:TreeViewItem>
    </DataTemplate>

    <local:ResourceTemplateSelector x:Key="ResourceTemplateSelector"
                                    FolderTemplate="{StaticResource FolderTemplate}"
                                    FileTemplate="{StaticResource FileTemplate}" />
  </UserControl.Resources>

  <!-- Resource Tree View -->
  <ScrollViewer VerticalScrollBarVisibility="Auto"
                VerticalAlignment="Stretch"
                ContextFlyout="{StaticResource ResourceContextMenu}">
    <muxc:TreeView x:Name="ResourcesTreeView"
                 ItemTemplateSelector="{StaticResource ResourceTemplateSelector}"
                 CanReorderItems="True"
                 SelectionMode="Single"
                 KeyDown="TreeView_KeyDown"
                 DragItemsCompleted="ResourcesTreeView_DragItemsCompleted"
                 AllowDrop="True"
                 DragOver="ResourcesTreeView_DragOver"
                 Drop="ResourcesTreeView_Drop"
                 SelectionChanged="ResourcesTreeView_SelectionChanged" />
  </ScrollViewer>
</UserControl>
